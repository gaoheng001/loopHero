# Loop Legend (循环英雄传说)

一个基于Godot 4.4引擎开发的《Loop Hero》类循环冒险游戏，融合了Roguelike、卡牌策略和自动战斗元素。玩家通过放置地形和建筑卡牌来影响英雄的循环冒险，收集资源建设营地，最终打破邪恶的时间循环。

![游戏预览](http://localhost:6007)

## 🎮 游戏特色

- **🔄 循环机制**: 英雄在12瓦片的圆形路径上自动移动
- **🃏 卡牌策略**: 通过放置4种类型卡牌影响游戏进程
- **⚔️ 自动战斗**: 英雄自动与敌人战斗，支持可视化战斗窗口
- **📈 渐进成长**: 通过循环获得资源、经验和装备
- **🏰 营地建设**: 使用5种资源升级营地设施
- **⏰ 时间系统**: 天数和步数系统影响游戏进程
- **👥 多职业**: 战士、盗贼、死灵法师三种职业可选

## 📁 项目结构

```
loopHero/
├── scenes/                    # 场景文件
│   ├── MainGame.tscn         # 主游戏场景
│   └── BattleWindow.tscn     # 战斗窗口场景
├── scripts/                   # 脚本文件
│   ├── GameManager.gd        # 游戏总管理器
│   ├── LoopManager.gd        # 循环管理器
│   ├── CardManager.gd        # 卡牌管理器
│   ├── HeroManager.gd        # 英雄管理器
│   ├── BattleManager.gd      # 战斗管理器
│   ├── BattleWindow.gd       # 战斗窗口控制器
│   └── MainGameController.gd # 主游戏控制器
├── resources/                 # 资源文件
│   ├── images/               # 图片资源
│   └── tilesets/             # 瓦片集资源
├── project.godot             # Godot项目配置
├── PRD.md                    # 产品需求文档
├── PHASE1_SUMMARY.md         # 第一阶段开发总结
├── DEVELOPMENT_REQUIREMENTS.md # 开发需求文档
└── README.md                 # 项目说明文档
```

## 🏗️ 核心系统架构

### 1. 游戏管理器 (GameManager)
- **游戏状态管理**: 主菜单、循环中、营地管理、暂停、游戏结束
- **资源系统**: 木材、石头、金属、魔法水晶、食物五种资源
- **全局事件处理**: 统一的事件分发机制
- **单例模式**: 全局访问的游戏状态

### 2. 循环管理器 (LoopManager)
- **英雄移动逻辑**: 12瓦片圆形路径自动移动
- **时间系统**: 天数和步数计数（每20步为1天）
- **怪物生成**: 每天自动在路径上生成怪物
- **循环检测**: 完成循环的检测和处理

### 3. 卡牌管理器 (CardManager)
- **卡牌数据库**: 敌人、地形、建筑、特殊四种类型
- **手牌管理**: 最大7张手牌，自动抽卡机制
- **卡牌放置**: 拖拽放置，规则验证
- **效果系统**: 卡牌相邻效果和组合效果

### 4. 英雄管理器 (HeroManager)
- **多职业系统**: 战士、盗贼、死灵法师
- **属性系统**: HP、攻击、防御、暴击、闪避等
- **装备系统**: 6个装备槽位，属性加成
- **升级机制**: 经验值和等级系统

### 5. 战斗管理器 (BattleManager)
- **自动战斗**: 回合制战斗逻辑
- **伤害计算**: 包含暴击、防御的复杂公式
- **战斗日志**: 详细的战斗记录
- **奖励分配**: 经验、资源、装备掉落

### 6. 战斗窗口 (BattleWindow) 🆕
- **可视化战斗**: 英雄vs怪物的直观显示
- **实时状态**: HP、攻击、防御数值实时更新
- **伤害特效**: 伤害数字飞出动画
- **状态反馈**: 受伤闪烁、血量颜色变化

## 🎯 核心玩法

### 循环探索
1. **选择英雄**: 从三种职业中选择适合的英雄
2. **放置卡牌**: 在循环路径周围放置各种卡牌
3. **自动冒险**: 英雄自动在路径上移动和战斗
4. **收集资源**: 获得经验、装备和建设资源
5. **策略决策**: 选择继续循环或撤退回营地

### 卡牌类型
- **🏔️ 地形卡**: 岩石、森林、草地等，提供基础效果
- **🏘️ 建筑卡**: 村庄、瞭望塔等，提供持续增益
- **👹 敌人卡**: 哥布林营地、骷髅墓穴等，增加挑战和奖励
- **✨ 特殊卡**: 宝库等，提供独特效果

### 英雄职业
- **⚔️ 战士**: 高血量和防御，适合持久战
- **🗡️ 盗贼**: 高闪避和暴击，爆发伤害强
- **💀 死灵法师**: 魔法攻击，特殊技能丰富

## 🚀 快速开始

### 环境要求
- **Godot引擎**: 4.4.1 或更高版本
- **操作系统**: Windows 10/11, macOS, Linux
- **内存**: 至少 4GB RAM
- **存储**: 至少 500MB 可用空间

### 运行步骤
1. **下载Godot**: 从 [官网](https://godotengine.org/) 下载Godot 4.4.1
2. **克隆项目**: `git clone [项目地址]`
3. **打开项目**: 在Godot中导入 `project.godot` 文件
4. **运行游戏**: 点击运行按钮或按 `F5` 开始游戏
5. **在线预览**: 访问 http://localhost:6007 查看游戏

## 🎮 操作指南

### 基础操作
- **🖱️ 鼠标左键**: 选择和放置卡牌
- **🖱️ 鼠标右键**: 取消卡牌选择
- **⏯️ 开始循环**: 开始英雄的循环冒险
- **🏃 撤退**: 从当前循环中撤退回营地
- **⏸️ 暂停**: 暂停/继续游戏

### 界面说明
- **顶部面板**: 显示资源数量和时间信息
- **左侧面板**: 显示英雄状态和属性
- **右侧面板**: 显示战斗日志和游戏信息
- **底部面板**: 显示手牌和控制按钮
- **中央区域**: 循环路径和卡牌放置区域

### 战斗窗口
- **自动弹出**: 遇到敌人时自动显示
- **实时更新**: 显示双方HP、攻击、防御
- **伤害特效**: 伤害数字和受伤动画
- **战斗记录**: 右侧显示详细战斗日志

## 📊 开发进度

### ✅ 第一阶段已完成 (2024年12月)
- **🏗️ 项目基础架构**: 完整的管理器系统
- **🔄 循环机制**: 12瓦片路径，英雄自动移动
- **🃏 卡牌系统**: 4种类型，放置机制，手牌管理
- **⚔️ 战斗系统**: 自动战斗，伤害计算，奖励分配
- **👤 英雄系统**: 3种职业，属性系统，升级机制
- **🖥️ 用户界面**: 完整的游戏UI，战斗窗口
- **⏰ 时间系统**: 天数步数计数，怪物生成
- **📊 资源系统**: 5种资源管理

### 🚧 第二阶段开发中
- **🛡️ 装备系统**: 装备掉落、管理、属性加成
- **🎯 技能系统**: 职业技能、状态效果
- **🏰 营地系统**: 建筑建造、资源消耗
- **🎨 视觉优化**: 动画特效、UI美化
- **🔊 音频系统**: 背景音乐、音效

### 📋 后续计划
- **📚 更多内容**: 新卡牌、新职业、新敌人
- **🏆 成就系统**: 游戏成就和奖励
- **💾 存档系统**: 游戏进度保存
- **⚖️ 平衡调整**: 数值优化和难度曲线
- **🎨 美术资源**: 专业美术资源替换

## 🔧 技术特性

### 引擎特性
- **🎮 Godot 4.4.1**: 使用最新稳定版本
- **🗺️ TileMapLayer**: 使用新的瓦片地图系统
- **📡 信号系统**: 事件驱动的松耦合架构
- **🎬 动画系统**: 流畅的UI和游戏动画
- **🎨 现代渲染**: 支持多种渲染效果

### 架构设计
- **📦 模块化**: 每个系统独立开发和测试
- **🔗 松耦合**: 通过信号进行模块间通信
- **📊 数据驱动**: 卡牌和配置数据可外部配置
- **🔄 可扩展**: 易于添加新功能和内容
- **🧪 可测试**: 清晰的接口便于单元测试

### 代码质量
- **📝 详细注释**: 所有核心函数都有完整注释
- **📏 代码规范**: 统一的命名和格式规范
- **🔍 类型安全**: 使用GDScript类型注解
- **📚 文档完整**: 包含PRD、开发需求、阶段总结

## 📈 项目统计

- **📄 代码行数**: ~2000行 (含注释)
- **📁 脚本文件**: 7个核心管理器
- **🎬 场景文件**: 2个主要场景
- **🃏 卡牌数量**: 8张基础卡牌
- **👥 英雄职业**: 3种可选职业
- **⚔️ 战斗系统**: 完整的自动战斗

## 📚 相关文档

- **[PRD.md](./PRD.md)**: 产品需求文档
- **[PHASE1_SUMMARY.md](./PHASE1_SUMMARY.md)**: 第一阶段开发总结
- **[DEVELOPMENT_REQUIREMENTS.md](./DEVELOPMENT_REQUIREMENTS.md)**: 开发需求文档

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进游戏！

### 开发流程
1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/新功能`)
3. 提交更改 (`git commit -am '添加新功能'`)
4. 推送到分支 (`git push origin feature/新功能`)
5. 创建 Pull Request

### 代码规范
- 遵循项目的代码风格
- 添加必要的注释
- 确保代码可以正常运行
- 更新相关文档

## 📄 许可证

本项目仅供学习和研究使用。

---

**开发团队** | **最后更新**: 2024年12月 | **版本**: v1.1